local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

local Freecam = Instance.new("ScreenGui")
Freecam.Parent = PlayerGui
Freecam.ResetOnSpawn = false

-- Function to add rounded corners
local function addRoundedCorners(instance, radius)
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, radius)
    UICorner.Parent = instance
end

-- Main UI Frame
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 500, 0, 300)
Frame.Position = UDim2.new(0.25, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.Parent = Freecam
addRoundedCorners(Frame, 5)

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TitleBar.Parent = Frame
addRoundedCorners(TitleBar, 5)

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 0)
CloseButton.Text = "X"
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
CloseButton.Parent = TitleBar
addRoundedCorners(CloseButton, 5)

CloseButton.MouseButton1Click:Connect(function()
    Freecam:Destroy()
end)

-- Side Panel (Tabs)
local SidePanel = Instance.new("Frame")
SidePanel.Size = UDim2.new(0, 150, 0, 270)
SidePanel.Position = UDim2.new(0, 10, 0, 35)
SidePanel.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
SidePanel.Parent = Frame
addRoundedCorners(SidePanel, 10)

-- Main Panel (Scripts Display)
local MainPanel = Instance.new("Frame")
MainPanel.Size = UDim2.new(0, 320, 0, 270)
MainPanel.Position = UDim2.new(0, 170, 0, 35)
MainPanel.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
MainPanel.Parent = Frame
addRoundedCorners(MainPanel, 5)

-- Search Box
local SearchBox = Instance.new("TextBox")
SearchBox.Size = UDim2.new(0, 140, 0, 30)
SearchBox.Position = UDim2.new(0, 5, 0, 5)
SearchBox.PlaceholderText = "Search ScriptBlox..."
SearchBox.Parent = SidePanel

local SearchButton = Instance.new("TextButton")
SearchButton.Size = UDim2.new(0, 140, 0, 30)
SearchButton.Position = UDim2.new(0, 5, 0, 40)
SearchButton.Text = "Search"
SearchButton.Parent = SidePanel
addRoundedCorners(SearchButton, 5)

-- Function to execute scripts
local function executeScript(scriptCode)
    local success, result = pcall(loadstring(scriptCode))
    if not success then
        warn("Error executing script:", result)
    end
end

-- Function to display scripts
local function displayScripts(scripts)
    for _, child in pairs(MainPanel:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    for i, scriptData in ipairs(scripts) do
        local scriptButton = Instance.new("TextButton")
        scriptButton.Size = UDim2.new(0, 280, 0, 30)
        scriptButton.Position = UDim2.new(0, 10, 0, (i - 1) * 35)
        scriptButton.Text = scriptData.title
        scriptButton.Parent = MainPanel
        addRoundedCorners(scriptButton, 5)

        scriptButton.MouseButton1Click:Connect(function()
            executeScript(scriptData.script)
        end)
    end
end

-- Function to search for scripts using ScriptBlox API
local function searchScripts(query)
    local url = "https://scriptblox.com/api/script/search?q=" .. HttpService:UrlEncode(query)
    local success, response = pcall(function()
        return HttpService:GetAsync(url)
    end)

    if success then
        local data = HttpService:JSONDecode(response)
        if data and data.results then
            local scripts = {}
            for _, result in ipairs(data.results) do
                table.insert(scripts, { title = result.name, script = result.script })
            end
            displayScripts(scripts)
        end
    else
        warn("Failed to fetch scripts from ScriptBlox")
    end
end

-- Search Button Functionality
SearchButton.MouseButton1Click:Connect(function()
    local query = SearchBox.Text
    if query and query ~= "" then
        searchScripts(query)
    end
end)

-- Dragging function for UI
local UIS = game:GetService("UserInputService")
local dragging, dragStart, startPos

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)
